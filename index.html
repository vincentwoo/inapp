<!doctype html>
<html>
<head>
<title>Displeased Avians</title>
<link rel="stylesheet" href="css/kd_components.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="css/kd_components_google.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
  $('#button').click(start);

  $('#buybg, #close').click(function() {
    $('#buyflow').fadeOut('fast');
  });

  $('#cardchange').click(function() {
    if ($('#right').css('left') == '8%') {
        $('#cardarrow').attr('src', 'images/disclosure_arrow_dk_grey_flip.png');
    } else {
        $('#cardarrow').attr('src', 'images/disclosure_arrow_dk_grey.png');
    }
    slideToggle();
  });

  $('.instrument_list li').click(function() {
    if ($(this).attr("class") == "expired") return;
    $('.instrument_list li').removeClass('card_line_selected');
    $(this).addClass('card_line_selected');
    updateCardThumb($(this));
    setTimeout(slideIn, 250);
  });
  
  $('.addcardbutton').click(function() {
    open('addinstrument.html', 'addinstrument',
         'resizable=yes, scrollbars=yes, status=no, width=579, height=468');
  });

  $('.loginbutton').click(function() {
    open('login.html', 'login',
         'resizable=yes, scrollbars=yes, status=no, width=577, height=439');
  });
  
  setTimeout(start, 500);
});

function updateCardThumb(card) {
  $('#cardchange').html("<img src='images/cc_" + card.attr("card_type") + ".png'> ***-" + card.attr("card_num") + " <img id='cardarrow' src='images/disclosure_arrow_dk_grey.png' />");
}

function start () {
  var state = $('input:radio[name=state]:checked').val();
  slideIn();
  $('#email').hide();
  $('#notlogged').hide();
  $('#newuser').hide();
  $('#cardchange').hide();
  $('#showinstruments_one').hide();
  $('#showinstruments_multi').hide();
  $('#multi_instrument_list').empty();

  if (state == 'logged_multi_line') {
    $('#subtotal_price').text('$5,024.84');
    $('#taxes_price').text('$401.99');
    $('#total_price').text('$5,426.83');
  } else if (state == 'logged_multi') {
    $('#subtotal_price').text('$1.99');
    $('#taxes_price').text('$0.00');
    $('#total_price').text('$1.99');
  } else if (state == 'logged_multi_quantity') {
    $('#subtotal_price').text('$7.96');
    $('#taxes_price').text('$0.64');
    $('#total_price').text('$8.60');
  }else {
    $('#subtotal_price').text('$1.99');
    $('#taxes_price').text('$0.16');
    $('#total_price').text('$2.15');
  }

  if ($('#total_price').text() == $('#subtotal_price').text()) {
    $('#subtotal_label').hide();
    $('#subtotal_price').hide();
    $('#taxes_label').hide();
    $('#taxes_price').hide();
    $('#summary_items').height(14);
  } else {
    $('#subtotal_label').show();
    $('#subtotal_price').show();
    $('#taxes_label').show();
    $('#taxes_price').show();
    $('#summary_items').height(36);
  }

  if (state == 'notlogged') $('#notlogged').show();
  else $('#email').show();
  if (state == 'newuser') $('#newuser').show();

  if (state == 'logged_multi_line') {
    $('#iteminfo_multi').show();
    $('#iteminfo_one').hide();
    $('#iteminfo_quantity').hide();
  } else if (state == 'logged_multi_quantity') {
    $('#iteminfo_one').hide();
    $('#iteminfo_quantity').show();
    $('#iteminfo_multi').hide();
  } else {
    $('#iteminfo_one').show();
    $('#iteminfo_quantity').hide();
    $('#iteminfo_multi').hide();
  }
  
  $('#buyflow').fadeIn('fast', function() {
    if (state != 'logged_one' && state != 'logged_multi' && state != 'logged_multi_line' && state != 'logged_multi_quantity') {
      slideOut();
      $('#buybutton').addClass('disabled');
    } else {
      if (state == 'logged_one') {
        $('#showinstruments_one').show();
        var cloned = $('#small_list').clone(true);
        $('#multi_instrument_list').append(cloned);
        cloned.show();
        $('#right').css('height', '259px');
      } else {
        var cloned = $('#big_list').clone(true);
        $('#multi_instrument_list').append(cloned);
        cloned.show();
        $('#showinstruments_multi').show();
      }
      $('#cardchange').show();
      $('#buybutton').removeClass('disabled');
    }
  });
}

function slideToggle() {
  if ($('#right').css('left') == '8%') slideOut();
  else slideIn();
}

function slideIn() {
  $('#right').css('left', '8%');
  $('#cardchange').removeClass('active');
}
function slideOut() {
  $('#right').css('left', '50%');
  $('#cardchange').addClass('active');
}

function addInstrumentDone() {
  if ($('#showinstruments_one').is(':visible')) {
    scrollTo($('#showinstruments_one'), $('#showinstruments_multi'), appendInstrument);
  }
  else appendInstrument();
}

function appendInstrument() {
  var cloned = $('#clone_visa').clone();
  cloned.attr('id', '');
  $('#multi_instrument_list ul').prepend(cloned);
  $('.instrument_list li').removeClass('card_line_selected');
  cloned.addClass('card_line_selected');
  updateCardThumb(cloned);
  cloned.hide();
  cloned.slideDown();
  $('#multi_instrument_list').scrollTop(0);
}

function loginDone() {

}

function scrollTo(current, target, callback) {
  var right = $('#right');
  right.css('-webkit-transition-property', 'height, left');
  target.show();
  target.css('height', right.outerHeight() + 'px');
    console.log(target.css('height'));
  right.animate({
      scrollTop: target.offset().top - right.offset().top + right.scrollTop() - 15
    },
    750,
    function () {
      current.hide();
      target.css('height', 'auto');
      right.css('height', target.outerHeight() + 30);
      setTimeout(function() {
        right.css('-webkit-transition-property', 'left');
        right.css('height', 'auto');
        callback();
      }, 500);
    });
}
</script>
</head>

<body>
<div id="main">
  <div id="config">
    <input type="radio" name="state" value="logged_multi_quantity"> Single Item/Multi Quantity<br /> 
    <input type="radio" name="state" value="logged_multi_line"> Multi Line Item/Quantity<br /> 
    <input type="radio" name="state" value="logged_multi"> Logged in (n instruments)<br /> 
    <input type="radio" name="state" value="logged_one" checked> Logged in (1 instrument)<br /> 
    <input type="radio" name="state" value="newuser"> New user <br />
    <input type="radio" name="state" value="notlogged"> Not Logged in <br />
  </div>
  <div id="button"></div>
</div>
<div id="buyflow">
  <div id="buybg"></div>
  <div id="frame">
    <div id="left">
      <div id="butter">
        <img src="images/x_close.gif" id="close" />
      </div>
      <div id="iteminfo_quantity">
        <img id="itemimage" src="images/eagle.png" />
        <b>A Mighty Eagle (Qty: 4)</b>
        <p>
          A mighty eagle decimates your enemies with deadly precision - buy one today. <span id='iteminfo_quantity_price'>($1.99 each)</span>
        </p>
        <div style="float: right">
          Sold by <b>Rovio</b>
          <img src="images/logo_rovio.png" style="vertical-align: middle; height: 35px; width: auto" />
        </div>
        <div style="clear:both"></div>
      </div>
      <div id="iteminfo_one">
        <img id="itemimage" src="images/eagle.png" />
        <b>A Mighty Eagle</b>
        <p>
          A mighty eagle decimates your enemies with deadly precision - buy one today.
        </p>
        <div style="float: right">
          Sold by <b>Rovio</b>
          <img src="images/logo_rovio.png" style="vertical-align: middle; height: 35px; width: auto" />
        </div>
        <div style="clear:both"></div>
      </div>
      <div id="iteminfo_multi">
        <div class='lineitems'>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/eagle.png" />
                  <div class='item_name'><b>A Mighty Eagle</b></div>
              </div>
              <div class='item_price'><b>$1.99</b></div>
          </div>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/eagle.png" />
                  <div class='item_name'><b>A Mightier Eagle</b></div>
              </div>
              <div class='item_price'><b>$2.99</b></div>
          </div>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/eagle.png" />
                  <div class='item_name'><b>Even Mightier Eagle</b></div>
              </div>
              <div class='item_price'><b>$3.99</b></div>
          </div>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/eagle.png" />
                  <div class='item_name'><b>The Mightiest Eagle</b></div>
              </div>
              <div class='item_price'><b>$4.99</b> <span class='quantity'>x2</span></div>
          </div>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/eagle.png" />
                  <div class='item_name'><b>Super Duper Ultra Mega Mightiest Eagle</b></div>
              </div>
              <div class='item_price'><b>$5.99</b></div>
          </div>
          <div class='lineitem'>
              <div class='item_data'>
                  <img id="itemimage_multi" src="images/honeybadger.jpg" />
                  <div class='item_name'><b>Honey Badger</b></div>
              </div>
              <div class='item_price'><b>$499.99</b> <span class='quantity'>x10</span></div>
          </div>
        </div>
        <div style="float: right">
          Sold by <b>Rovio</b>
          <img src="images/logo_rovio.png" style="vertical-align: middle; height: 35px; width: auto" />
        </div>
        <div style="clear:both"></div>
      </div>
      <div id="sellerinfo">
        <div id="cost">
            <div id='summary_items'>
              <span id='subtotal_label'>subtotal <b><span id='subtotal_price'>$1.99</span></b></span>
              <span id='taxes_label'>taxes <b><span id='taxes_price'>$0.16</span></b></span>
            </div>
            <span id="total">total <b><span id='total_price'>$2.15</span></b></span>
        </div>

        <div class="kd-button" id="cardchange">
          <img src='images/cc_master.png' />
          **-9998
          <div class='cardarrow_box'>
            <img id='cardarrow' src='images/disclosure_arrow_dk_grey.png' />
          </div>
        </div>

      </div>
      <a id="buybutton" class="kd-button kd-button-submit">Buy Now</a>
    </div>
    <div id="right">
      <a id="email">vwoo@google.com</a>
      
      <div id="notlogged">
        <h3>Security Check Required</h3>
        <p>
          To ensure your security, you must log in to Google Wallet.<br /><br />Please click the button below to log in.
        </p>
        <div class="kd-button kd-button-submit loginbutton" style="float: right; margin: 10px">Log In in a new window</div>
      </div>
      
      <div id="newuser">
        <div id="addcard">
          <p>
            You need to add a card to your Google Wallet to make this purchase.
          </p>
        </div>
        <div class="kd-button addcardbutton" style="float:right; margin: 10px 0 0 10px;">
          <div>
            Add card in a new window
          </div>
        </div>

      </div>

      <div id="showinstruments_one">
        <div id="bigcard">
          <img src="images/mc_logo.png" />
          **** **** **** 9998
          <br />
          <br />
          <div style='float: right; padding-right: 20px;'>
            exp. 02/14
          </div>
        </div>
        <p style="clear:both">
          You currently have only one valid payment method stored in your Google Wallet.  To add another, click the button below.
        </p>
        <div class="kd-button addcardbutton" style="float:right; margin-bottom: 20px">
          <div>
            Add card in a new window
          </div>
        </div>
        <div style="clear: both"></div>
      </div>
      
      <div id="showinstruments_multi">
        <div id="multi_instrument_list">

        </div>
        <div class="kd-button addcardbutton" style="float:right; margin: 10px 0 15px 10px;">
          <div>
            Add card in a new window
          </div>
        </div>
        <div style="clear:both"></div>
      </div>
    </div>
  </div>
</div>

<!-- not shown -->
<ul id="big_list" class='instrument_list' style='position: relative: top: 0;'>
    <li class="card_line_selected" card_type='master' card_num='9998'>
        <div class='card_image'><img src='images/cc_master.png' /></div>
        <div class='card_details'>***-9998</div>
        <div class='card_expire'>(expires 11/13)</div>
    </li>
    <li card_type='visa' id="clone_visa" card_num='3431'>
        <div class='card_image'><img src='images/cc_visa.png' /></div>
        <div class='card_details'>***-3431</div>
        <div class='card_expire'>(expires 07/14)</div>
    </li>
    <li card_type='discover' card_num='5714'>
        <div class='card_image'><img src='images/cc_discover.png' /></div>
        <div class='card_details'>***-5714</div>
        <div class='card_expire'>(expires 06/13)</div>
    </li>
    <li card_type='amex' card_num='1312'>
        <div class='card_image'><img src='images/cc_amex.png' /></div>
        <div class='card_details'>***-1312</div>
        <div class='card_expire'>(expires 02/15)</div>
    </li>
    <li card_type='master' card_num='2116'>
        <div class='card_image'><img src='images/cc_master.png' /></div>
        <div class='card_details'>***-2116</div>
        <div class='card_expire'>(expires 04/14)</div>
    </li>
    <li class='expired' card_type='discover' card_num='9283' style="border: 0">
        <div class='card_image card_expired'><img src='images/cc_discover.png' /></div>
        <div class='card_details card_details_expired'>***-9283</div>
        <div class='card_expire card_expired'>(expired 01/12)</div>
    </li>
</ul>
<ul id="small_list" class='instrument_list' style='position: relative: top: 0;'>
    <li class="card_line_selected" card_type='master' card_num='9998'>
        <div class='card_image'><img src='images/cc_master.png' /></div>
        <div class='card_details'>***-9998</div>
        <div class='card_expire'>(expires 11/13)</div>
    </li>
</ul>

</body>
</html>
