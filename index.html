<!doctype html>
<html>
<head>
<title>Displeased Avians</title>
<link rel="stylesheet" href="css/kd_components.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="css/kd_components_google.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
  $('#button').click(start);

  $('#buybg, #close').click(function() {
    $('#buyflow').fadeOut('fast');
  });

  $('#cardchange').click(function() {
    if ($('#right').css('left') == '8%') {
        $('#cardarrow').attr('src', 'images/disclosure_arrow_dk_grey_flip.png');
    } else {
        $('#cardarrow').attr('src', 'images/disclosure_arrow_dk_grey.png');
    }
    slideToggle();
  });

  $('.instrument_list li').click(function() {
    if ($(this).attr("class") == "expired") return;
    $('.instrument_list li.card_line_selected').toggleClass('card_line_selected');
    $(this).toggleClass('card_line_selected');
    if (($(this).attr("card_type") == "visa" ||
         $(this).attr("card_type") == "master" ||
         $(this).attr("card_type") == "discover" ||
         $(this).attr("card_type") == "amex") &&
        ($(this).attr("card_num").length == 4)) {
      $('#cardchange').html("<img src='images/cc_" + $(this).attr("card_type") + ".png'> ***-" + $(this).attr("card_num") + " <img id='cardarrow' src='images/disclosure_arrow_dk_grey.png' />");
      setTimeout(slideIn, 250);
    }
  });
  
  $('.addcardbutton').click(function() {
    open('addinstrument.html', 'addinstrument',
         'resizable=yes, scrollbars=yes, status=no, width=579, height=468');
  });

  $('.loginbutton').click(function() {
    open('login.html', 'login',
         'resizable=yes, scrollbars=yes, status=no, width=577, height=439');
  });
  
  setTimeout(start, 500);
});

function start () {
  var state = $('input:radio[name=state]:checked').val();
  slideIn();
  $('#email').hide();
  $('#notlogged').hide();
  $('#newuser').hide();
  $('#cardchange').hide();
  $('#showinstruments_one').hide();
  $('#showinstruments_multi').hide();

  if (state == 'notlogged') $('#notlogged').show();
  else $('#email').show();
  if (state == 'newuser') $('#newuser').show();
  
  $('#buyflow').fadeIn('fast', function() {
    if (state != 'logged_one' && state != 'logged_multi') {
      slideOut();
      $('#buybutton').addClass('disabled');
    } else {
      if (state == 'logged_one') {
        $('#showinstruments_one').show();
        $('#right').css('height', '259px');
      } else {
        $('#showinstruments_multi').show();
      }
      $('#cardchange').show();
      $('#buybutton').removeClass('disabled');
    }
  });
}

function slideToggle() {
  if ($('#right').css('left') == '8%') slideOut();
  else slideIn();
}

function slideIn() {
  $('#right').css('left', '8%');
  $('#cardchange').removeClass('active');
}
function slideOut() {
  $('#right').css('left', '50%');
  $('#cardchange').addClass('active');
}

function addInstrumentDone() {
  if ($('#showinstruments_one').is(':visible')) {
    scrollTo($('#showinstruments_one'), $('#showinstruments_multi'));
  }
}

function loginDone() {

}

function scrollTo(current, target) {
  var right = $('#right');
  right.css('-webkit-transition-property', 'height, left');
  target.show();
  console.log(target.css('height'));
  target.css('height', right.outerHeight() + 'px');
    console.log(target.css('height'));
  right.animate({
      scrollTop: target.offset().top - right.offset().top + right.scrollTop() - 15
    },
    1000,
    function () {
      current.hide();
      target.css('height', 'auto');
      right.css('height', target.outerHeight());
      setTimeout(function() {
        right.css('-webkit-transition-property', 'left');
      }, 1000);
    });
}
</script>
</head>

<body>
<div id="main">
  <div id="config">
    <input type="radio" name="state" value="logged_multi"> Logged in (n instruments)<br /> 
    <input type="radio" name="state" value="logged_one" checked> Logged in (1 instrument)<br /> 
    <input type="radio" name="state" value="notlogged"> Not Logged in <br />
    <input type="radio" name="state" value="newuser"> New user <br />
  </div>
  <div id="button"></div>
</div>
<div id="buyflow">
  <div id="buybg"></div>
  <div id="frame">
    <div id="left">
      <div id="butter">
        <img src="images/x_close.gif" id="close" />
      </div>
      <div id="iteminfo">
        <img id="itemimage" src="images/eagle.png" />
        <b>A Mighty Eagle</b>
        <p>
          A mighty eagle decimates your enemies with deadly precision - buy one today.
        </p>
        <div style="float: right">
          Sold by <b>Rovio</b>
          <img src="images/logo_rovio.png" style="vertical-align: middle; height: 35px; width: auto" />
        </div>
        <div style="clear:both"></div>
      </div>
      <div id="sellerinfo">
        <div id="cost">
            <span>subtotal <b>$1.99</b></span>
            <span>taxes <b>$0.13</b></span>
            <span id="total">total <b>$2.12</b></span>
        </div>

        <div class="kd-button" id="cardchange">
          <img src='images/cc_master.png' />
          **-9998
          <div class='cardarrow_box'>
            <img id='cardarrow' src='images/disclosure_arrow_dk_grey.png' />
          </div>
        </div>

      </div>
      <a id="buybutton" class="kd-button kd-button-submit">Buy Now</a>
    </div>
    <div id="right">
      <a id="email">vwoo@google.com</a>
      
      <div id="notlogged">
        <h3>Security Check Required</h3>
        <p>
          To ensure your security, you must log in to Google Wallet.<br /><br />Please click the button below to log in.
        </p>
        <div class="kd-button kd-button-submit loginbutton" style="float: right; margin: 10px">Log In in a new window</div>
      </div>
      
      <div id="newuser">
        <div id="addcard">
          <p>
            You need to add a card to your Google Wallet to make this purchase.
          </p>
        </div>
        <div class="kd-button addcardbutton" style="float:right; margin: 10px 0 0 10px;">
          <div>
            Add card in a new window
          </div>
        </div>

      </div>

      <div id="showinstruments_one">
        <div id="bigcard">
          <img src="images/mc_logo.png" />
          **** **** **** 9998
          <br />
          <br />
          <div style='float: right; padding-right: 20px;'>
            exp. 02/14
          </div>
        </div>
        <p style="clear:both">
          You currently have only one valid payment method stored in your Google Wallet.  To add another, click the button below.
        </p>
        <div class="kd-button addcardbutton" style="float:right; margin-bottom: 20px">
          <div>
            Add card in a new window
          </div>
        </div>
        <div style="clear: both"></div>
      </div>
      
      <div id="showinstruments_multi">
        <ul class='instrument_list'>
            <li class="card_line_selected" card_type='master' card_num='9998'>
                <div class='card_image'><img src='images/cc_master.png' /></div>
                <div class='card_details'>***-9998</div>
                <div class='card_expire'>(expires 11/13)</div>
            </li>
            <li card_type='visa' card_num='3431'>
                <div class='card_image'><img src='images/cc_visa.png' /></div>
                <div class='card_details'>***-3431</div>
                <div class='card_expire'>(expires 07/14)</div>
            </li>
            <li card_type='amex' card_num='1312'>
                <div class='card_image'><img src='images/cc_amex.png' /></div>
                <div class='card_details'>***-1312</div>
                <div class='card_expire'>(expires 02/15)</div>
            </li>
            <li class='expired' card_type='discover' card_num='9283' style="border: 0">
                <div class='card_image card_expired'><img src='images/cc_discover.png' /></div>
                <div class='card_details card_details_expired'>***-9283</div>
                <div class='card_expire card_expired'>(expired 01/12)</div>
            </li>
        </ul>
        <div class="kd-button addcardbutton" style="float:right; margin: 10px 0 0 10px;">
          <div>
            Add card in a new window
          </div>
        </div>
        <div style="clear:both"></div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
